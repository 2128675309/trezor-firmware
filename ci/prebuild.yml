image: registry.gitlab.com/satoshilabs/trezor/trezor-firmware/trezor-firmware-env.nix

#style prebuild:
#  stage: prebuild
#  only:
#    changes:
#      - .gitlab-ci.yml
#      - ci/**/*
#      - "**/*.c"
#      - "**/*.h"
#      - "**/*.py"
#  script:
#    - nix-shell --run "poetry run make style_check"
#
#common prebuild:
#  stage: prebuild
#  only:
#    changes:
#      - .gitlab-ci.yml
#      - ci/**/*
#      - "**/*.json"
#      - "**/*.proto"
#  script:
#    - nix-shell --run "poetry run make defs_check"
#
#gen prebuild:
#  stage: prebuild
#  only:
#    changes:
#      - .gitlab-ci.yml
#      - ci/**/*
#      - "**/*.c"
#      - "**/*.h"
#      - "**/*.json"
#      - "**/*.proto"
#      - "**/*.py"
#      - "**/*.pyi"
#  script:
#    - nix-shell --run "poetry run make gen_check"
#
#release commit messages prebuild:
#  stage: prebuild
#  before_script: []  # nothing needed
#  variables:
#    # We need to clone the repo properly so we can work with origin/master.
#    GIT_STRATEGY: clone
#  only:
#    refs:
#      - /^release\//
#    variables:
#      # We want this to run on gitlab.com/satoshilabs/trezor/trezor-firmware only.
#      - $CI_PROJECT_PATH_SLUG == 'satoshilabs-trezor-trezor-firmware'
#  script:
#    - nix-shell --run "ci/check_release_commit_messages.sh"

xxx:
  stage: prebuild
  variables:
    DEPLOY_PATH: "${DEPLOY_BASE_DIR}/releases/firmwares"
  before_script: []  # no pipenv
  script:
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-1.9.1-c6b2580c.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-1.9.2-63ebb8cc.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-1.9.3-0d5f0066.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-2.2.0-02724da0.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-2.3.0-0b7a8449.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-2.3.1-c6b2580c.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-2.3.2-63ebb8cc.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-2.3.3-0d5f0066.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-2.3.4-50854b92.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-debug-1.9.2-63ebb8cc.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-btconly-debug-1.9.3-0d5f0066.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-1.9.0-0b7a8449.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-1.9.1-c6b2580c.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-1.9.2-63ebb8cc.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-1.9.3-0d5f0066.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-2.2.0-02724da0.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-2.3.0-0b7a8449.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-2.3.1-c6b2580c.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-2.3.2-63ebb8cc.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-2.3.3-0d5f0066.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-2.3.4-50854b92.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-debug-1.9.2-63ebb8cc.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-debug-1.9.3-0d5f0066.bin ${DEPLOY_PATH}/t1/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-debug-2.3.2-63ebb8cc.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-debug-2.3.3-0d5f0066.bin ${DEPLOY_PATH}/tt/
    - mv ${DEPLOY_PATH}/trezor-fw-regular-debug-2.3.4-50854b92.bin ${DEPLOY_PATH}/tt/
  tags:
    - deploy
