image: registry.gitlab.com/satoshilabs/trezor/trezor-firmware/trezor-firmware-env.nix

#style prebuild:
#  stage: prebuild
#  only:
#    changes:
#      - .gitlab-ci.yml
#      - ci/**/*
#      - "**/*.c"
#      - "**/*.h"
#      - "**/*.py"
#  script:
#    - nix-shell --run "poetry run make style_check"
#
#common prebuild:
#  stage: prebuild
#  only:
#    changes:
#      - .gitlab-ci.yml
#      - ci/**/*
#      - "**/*.json"
#      - "**/*.proto"
#  script:
#    - nix-shell --run "poetry run make defs_check"
#
#gen prebuild:
#  stage: prebuild
#  only:
#    changes:
#      - .gitlab-ci.yml
#      - ci/**/*
#      - "**/*.c"
#      - "**/*.h"
#      - "**/*.json"
#      - "**/*.proto"
#      - "**/*.py"
#      - "**/*.pyi"
#  script:
#    - nix-shell --run "poetry run make gen_check"
#
#release commit messages prebuild:
#  stage: prebuild
#  before_script: []  # nothing needed
#  variables:
#    # We need to clone the repo properly so we can work with origin/master.
#    GIT_STRATEGY: clone
#  only:
#    refs:
#      - /^release\//
#    variables:
#      # We want this to run on gitlab.com/satoshilabs/trezor/trezor-firmware only.
#      - $CI_PROJECT_PATH_SLUG == 'satoshilabs-trezor-trezor-firmware'
#  script:
#    - nix-shell --run "ci/check_release_commit_messages.sh"

xxx:
  stage: prebuild
  variables:
    DEPLOY_PATH: "${DEPLOY_BASE_DIR}/releases/firmwares"
  before_script: []  # no pipenv
  script:
#    - mv ${DEPLOY_BASE_DIR}/upgrade_tests ${DEPLOY_BASE_DIR}/upgrade_tests.bak
	- rsync -va sushi/trezor-fw-btconly-2.1.6-629fa58d.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-1.7.3-f641e798.bin ${DEPLOY_PATH}/t1/
	- rsync -va sushi/trezor-fw-regular-2.0.10-5c3a5d457.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.0.8-939a9322.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.1.1-7af1d585.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.1.2-50f16366.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.1.3-5edffb32.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.1.4-6a1a02c.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.1.7-2cabc8b4.bin ${DEPLOY_PATH}/tt/
	- rsync -va sushi/trezor-fw-regular-2.1.8-8eb6ce08.bin ${DEPLOY_PATH}/tt/
  tags:
    - deploy
